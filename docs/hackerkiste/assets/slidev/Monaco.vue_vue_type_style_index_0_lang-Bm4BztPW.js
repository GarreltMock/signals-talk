const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/slidev/CodeRunner-v4QlCCle.js","assets/modules/vue-Ce80C8wT.js","assets/monaco/bundled-types-DKgBjz8S.js","assets/modules/file-saver-BirHVELW.js","assets/monaco/bundled-types-vrNnVE2R.css","assets/index-DCsmTLhi.js","assets/modules/shiki-DoHTQ3py.js","assets/modules/shiki-Bxv373Z5.css","assets/index-DUozkhuC.css","assets/slidev/context-qDJ021VH.js","assets/slidev/IconButton.vue_vue_type_script_setup_true_lang-BPiA5iZJ.js","assets/CodeRunner-DcJPFc8h.css"])))=>i.map(i=>d[i]);
import{_ as h,d as H}from"../monaco/bundled-types-DKgBjz8S.js";import{d as K,t as l,A as L,T as U,N as Y,n as v,o as M,b as Z,e as x,h as q,c as G,K as B,g as J,U as Q}from"../modules/vue-Ce80C8wT.js";import{l as N}from"../lz-string-Do_w-xIU.js";import{k as X,m as V}from"../index-DCsmTLhi.js";import{u as ee}from"./context-qDJ021VH.js";const te={class:"relative slidev-monaco-container"},de=K({__name:"Monaco",props:{codeLz:{default:""},diffLz:{},lang:{default:"typescript"},readonly:{type:Boolean,default:!1},lineNumbers:{default:"off"},height:{default:"initial"},editorOptions:{},ata:{type:Boolean,default:!0},runnable:{type:Boolean,default:!1},writable:{},autorun:{type:[Boolean,String],default:!0},showOutputAt:{type:[null,Boolean,String,Number,Array]},outputHeight:{},highlightOutput:{type:Boolean,default:!0},runnerOptions:{}},setup(k){const e=k,D=Q(()=>h(()=>import("./CodeRunner-v4QlCCle.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11])).then(s=>s.default)),d=l(N.decompressFromBase64(e.codeLz).trimEnd()),y=e.diffLz&&l(N.decompressFromBase64(e.diffLz).trimEnd()),A=L(()=>e.writable&&!e.readonly&&!1),p={ts:"typescript",js:"javascript"}[e.lang]??e.lang,C={typescript:"mts",javascript:"mjs",ts:"mts",js:"mjs"}[e.lang]??e.lang,F=l(),f=l(),m=l(0),r=l(),R=L(()=>e.height==="auto"?`${m.value}px`:e.height==="initial"?`${r.value}px`:e.height),_=l(),{$page:P,$renderContext:T}=ee(),{currentSlideNo:W}=X(),$=U(()=>Math.abs(P.value-W.value)<=1&&_.value,s=>{["slide","presenter"].includes(T.value)?s():setTimeout(s,5e3)}),b=()=>window.devicePixelRatio/2||1;return Y(async()=>{var S;const{default:s}=await h(async()=>{const{default:t}=await import("../monaco/bundled-types-DKgBjz8S.js").then(a=>a.x);return{default:t}},__vite__mapDeps([2,3,1,4])),{ata:u,monaco:o,editorOptions:I}=await s(),c=o.editor.createModel(d.value,p,o.Uri.parse(`file:///${V()}.${C}`));c.onDidChangeContent(()=>d.value=c.getValue());const z={automaticLayout:!0,readOnly:e.readonly,lineNumbers:e.lineNumbers,minimap:{enabled:!1},overviewRulerBorder:!1,overviewRulerLanes:0,padding:{top:10,bottom:10},lineNumbersMinChars:3,bracketPairColorization:{enabled:!1},tabSize:2,fontFamily:"var(--slidev-code-font-family)",scrollBeyondLastLine:!1,useInlineViewWhenSpaceIsLimited:!1,...I,...e.editorOptions,fontSize:(((S=e.editorOptions)==null?void 0:S.fontSize)??11.5)*b()};let n;if(y){const t=o.editor.createModel(y.value,p,o.Uri.parse(`file:///${V()}.${C}`));t.onDidChangeContent(()=>d.value=c.getValue());const a=o.editor.createDiffEditor(f.value,{renderOverviewRuler:!1,...z});a.setModel({original:c,modified:t});const i=a.getOriginalEditor(),g=a.getModifiedEditor(),O=()=>{const E=Math.max(i.getContentHeight(),g.getContentHeight())+4;r.value??(r.value=E),m.value=E,v(()=>a.layout())};i.onDidContentSizeChange(O),g.onDidContentSizeChange(O),n=g}else{const t=o.editor.create(f.value,{model:c,lineDecorationsWidth:0,...z});t.onDidContentSizeChange(a=>{const i=a.contentHeight+4;r.value??(r.value=i),m.value=i,v(()=>n.layout())}),n=t}_.value=()=>{$(),h(()=>import("../monaco/bundled-types-DKgBjz8S.js").then(t=>t.y),__vite__mapDeps([2,3,1,4])),e.ata&&(u(n.getValue()),n.onDidChangeModelContent(H(1e3,()=>{u(n.getValue())})))};const j=n.layoutContentWidget.bind(n);n.layoutContentWidget=t=>{j(t),t.getId()==="editor.contrib.resizableContentHoverWidget"&&(t._resizableNode.domNode.style.transform=t._positionPreference===1?"translateY(calc(100% * (var(--slidev-slide-scale) - 1)))":"")},n.addAction({id:"slidev-save",label:"Save",keybindings:[o.KeyMod.CtrlCmd|o.KeyCode.KeyS],run:()=>{A.value,console.warn("[Slidev] this monaco editor is not writable, save action is ignored.")}}),v(()=>o.editor.remeasureFonts()),setTimeout(()=>o.editor.remeasureFonts(),1e3);const w=()=>{var i;const t=b(),a=(((i=e.editorOptions)==null?void 0:i.fontSize)??12)*t;n.updateOptions({fontSize:a}),o.editor.remeasureFonts()};window.addEventListener("resize",w),window.addEventListener("devicePixelRatioChange",w)}),(s,u)=>(M(),Z("div",te,[x("div",{ref_key:"outer",ref:F,class:"relative slidev-monaco-container-inner",style:q({height:R.value})},[x("div",{ref_key:"container",ref:f,class:"absolute inset-0.5"},null,512)],4),e.runnable?(M(),G(B(D),{key:0,modelValue:d.value,"onUpdate:modelValue":u[0]||(u[0]=o=>d.value=o),lang:B(p),autorun:e.autorun,"show-output-at":e.showOutputAt,height:e.outputHeight,"highlight-output":e.highlightOutput,"runner-options":e.runnerOptions},null,8,["modelValue","lang","autorun","show-output-at","height","highlight-output","runner-options"])):J("v-if",!0)]))}});export{de as _};
